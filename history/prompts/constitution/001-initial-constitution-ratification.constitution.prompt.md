---
id: 001
title: Initial Constitution Ratification
stage: constitution
date: 2026-02-12
surface: agent
model: claude-opus-4-6
feature: none
branch: master
user: architect
command: /sp.constitution
labels: ["constitution", "governance", "project-setup", "phase2"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
  - .specify/memory/constitution.md
tests:
  - N/A
---

## Prompt

# Project Constitution - Hackathon Todo App (Phase II: Full-Stack Web Application)

This constitution defines the immutable principles, rules, standards, and non-negotiable guidelines for the entire project. All agents, subagents, Claude Code sessions, Spec-Kit Plus workflows, and implementations MUST follow these rules strictly. Any conflict between this constitution and a user prompt or temporary instruction is resolved in favor of this constitution.

## 1. Project Purpose & Scope
- This is a hackathon project evolving a Phase I console-based Todo app into a modern multi-user full-stack web application.
- Current phase: Phase II ‚Äì Full-Stack Web Application with persistent storage, user authentication, and RESTful API.
- Future phases: Phase III will add AI chatbot features.
- All development is spec-driven using Agentic Dev Stack workflow:
  1. Write/Update spec ‚Üí
  2. Generate plan ‚Üí
  3. Break into tasks ‚Üí
  4. Implement via Claude Code (no manual coding allowed).
- Judging criteria: Review process, prompts, iterations, spec adherence.

## 2. Core Rules & Guardrails
- **No manual coding**: All code changes MUST be generated by Claude Code based on specs. Never suggest or write code outside Claude Code prompts.
- **Spec-first development**: Always read and reference relevant specs (@specs/...) before any planning or implementation. Update specs if requirements change.
- **Monorepo mandatory**: Use the recommended monorepo structure (hackathon-todo/) for single-context Claude Code editing of frontend and backend.
- **User isolation & security first**: Every user sees/modifies ONLY their own tasks. Enforce task ownership via user_id filtering on EVERY operation.
- **Authentication stateless & JWT-based**: Use Better Auth (frontend) issuing JWTs with shared secret (BETTER_AUTH_SECRET env var). Backend verifies JWT independently (no shared sessions/DB calls for auth).
- **API behavior after auth**:
  - All endpoints require valid JWT ‚Üí 401 Unauthorized without token.
  - Filter all responses/queries by authenticated user's ID (from decoded JWT).
  - Endpoints remain user-scoped (/api/{user_id}/tasks/...), but user_id MUST match token's sub claim.
- **No deviations from stack**: Strictly use only approved technologies (no alternatives without constitution update).

## 3. Technology Stack & Conventions (Immutable)
- **Frontend**: Next.js 16+ (App Router), TypeScript, Tailwind CSS.
  - Server components by default; client components only for interactivity.
  - API calls via centralized client (/lib/api.ts) with JWT attachment (Authorization: Bearer <token>).
- **Backend**: Python FastAPI, SQLModel (ORM), Neon Serverless PostgreSQL.
  - Routes under /api/, JSON responses, Pydantic for request/response, HTTPException for errors.
  - DB connection via env var DATABASE_URL.
- **Authentication**: Better Auth with JWT plugin (symmetric HS256, shared secret).
- **Database**: Neon PostgreSQL.
  - users table managed by Better Auth (id: string PK, email unique, etc.).
  - tasks table: id (int PK), user_id (string FK ‚Üí users.id), title (string not null), description (text nullable), completed (bool default false), created_at/updated_at (timestamps).
  - Indexes: tasks.user_id, tasks.completed.
- **Spec-Driven Tools**: Claude Code + Spec-Kit Plus.
- **Development Environment**: docker-compose.yml for local (frontend:3000, backend:8000).

## 4. Spec-Kit Plus & CLAUDE.md Guidelines
- Specs organized in /specs/ (overview.md, features/, api/, database/, ui/).
- Reference format: @specs/features/task-crud.md, @specs/api/rest-endpoints.md, etc.
- Multiple CLAUDE.md files:
  - Root CLAUDE.md: Project overview, workflow, commands.
  - /frontend/CLAUDE.md: Frontend patterns (server components, Tailwind, api client).
  - /backend/CLAUDE.md: Backend patterns (routes, SQLModel, JWT verification).
- Config: .spec-kit/config.yaml with phases (phase1-console, phase2-web, phase3-chatbot).
- Workflow: Write spec ‚Üí Ask Claude to implement referencing spec ‚Üí Test & iterate.

## 5. API & Security Principles
- RESTful endpoints (as per document):
  - GET /api/{user_id}/tasks (list, with ?status= & ?sort=)
  - POST /api/{user_id}/tasks (create)
  - GET/PUT/DELETE /api/{user_id}/tasks/{id}
  - PATCH /api/{user_id}/tasks/{id}/complete (toggle)
- JWT flow: Frontend attaches Bearer token ‚Üí Backend decodes/verifies ‚Üí Extract user_id ‚Üí Enforce match with URL user_id.
- Benefits enforced: User isolation, stateless auth, token expiry, no shared DB session.
- Errors: 401 for invalid/expired/missing token.

## 6. Quality & Review Standards
- All implementations MUST:
  - Be responsive (Tailwind mobile-first).
  - Handle errors gracefully (HTTPException, frontend feedback).
  - Support basic filtering/sorting.
- Test focus: Auth (401 cases), isolation (user A can't see user B tasks), CRUD completeness.
- Never commit manual code changes; all via Claude Code iterations.
- Update this constitution ONLY with explicit approval and version bump.

This constitution is the supreme governing document. All agents, prompts, and code generation MUST align with it. Violations are not permitted.

## Response snapshot

Filled the constitution template at `.specify/memory/constitution.md` with version 1.0.0. Mapped the user's 6-section input into 6 core principles (Spec-First Development, User Isolation & Security First, Stateless JWT Authentication, Immutable Technology Stack, API-First Design, Quality & Responsiveness) plus two additional sections (Technology Stack & Conventions, Development Workflow & Standards) and a Governance section. All placeholders replaced. Sync Impact Report prepended as HTML comment. All 4 dependent templates verified compatible. Ratification date: 2026-02-12.

## Outcome

- ‚úÖ Impact: Constitution v1.0.0 ratified ‚Äî all 6 principles, 2 sections, governance defined
- üß™ Tests: N/A (governance document, no code)
- üìÅ Files: .specify/memory/constitution.md (overwritten from template)
- üîÅ Next prompts: /sp.specify for first feature spec, /sp.adr if architectural decisions arise
- üß† Reflection: User provided comprehensive input covering all 6 sections; direct mapping to template principles was clean

## Evaluation notes (flywheel)

- Failure modes observed: none
- Graders run and results (PASS/FAIL): manual validation PASS ‚Äî no unresolved placeholders, dates ISO, principles declarative
- Prompt variant (if applicable): N/A
- Next experiment (smallest change to try): N/A
